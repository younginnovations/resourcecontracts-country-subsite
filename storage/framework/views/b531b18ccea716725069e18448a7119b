<?php
use Illuminate\Support\Facades\Lang;

?>


<?php $__env->startSection('content'); ?>

    <div class="row">
        <div class="col-lg-12 panel-top-wrapper">
            <div class="panel-top-content">
                <?php if($referrer != ''): ?>
                <a href="<?php echo e($referrer); ?>" class="back contract-back"><span><?php echo app('translator')->get('global.go_back'); ?></span></a>
                <?php endif; ?>
                <div class="pull-left">
                    <div class="breadcrumb-wrapper contract-breadcrumb-wrapper">
                        <ul>
                            <li><a href="<?php echo e(url()); ?>"><?php echo app('translator')->get('global.home'); ?></a></li>
                            <li><a href="<?php echo e(route('contracts')); ?>"><?php echo e(Lang::choice('global.contracts' , 2)); ?></a></li>
                            <li><?php echo e(str_limit($contract->metadata->name, 100)); ?></li>
                        </ul>
                    </div>

                    <div class="panel-title contract-panel-title">
                    <?php echo e($contract->metadata->name); ?>

                </div>
                </div>
                <div class="action-links">
                    <ul>
                        <?php if($contract->pages->total>0): ?>
                            <li class="pull-left">
                                    <a href="<?php echo e(route('contract.detail',['id'=>$contract->metadata->open_contracting_id])); ?>"><?php echo app('translator')->get('global.view_document'); ?></a>
                            </li>
                        <?php endif; ?>
                    </ul>
                </div>
            </div>
            <div class="filter-wrapper actions-wrapper">
                <div class="col-lg-12">
                    <div class="download-main-wrap">
                        <div class="download-wrap">
                            <span><?php echo app('translator')->get('global.download'); ?></span>
                        </div>

                        <ul class="dropdown-menu">
                            <li><a href="<?php echo e(_e($contract->metadata->file[0], 'url')); ?>" target="_blank">Pdf</a></li>
                            <?php if(_e($contract->metadata->file[1], 'url') !='' && env('CATEGORY')!="olc"): ?>
                                <li><a href="<?php echo e(route('contract.download',['id'=> $contract->metadata->open_contracting_id])); ?>"
                                       target="_blank">Word File</a></li>
                            <?php endif; ?>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="row contract-detail-wrapper">
        <div class="col-lg-12">
            <div class="col-md-6 col-lg-6">
                <div class="panel panel-default panel-wrap panel-contract-wrap">
                    <div class="panel-body">
                        <ul>
                            <li class="col-lg-12 open-contracting-id">
                                <label for=""><?php echo app('translator')->get('contract.open_contracting_id'); ?></label>
                                <span><?php echo e(_e($contract->metadata,'open_contracting_id','-')); ?></span>
                            </li>
                        </ul>
                        <ul>
                            <li class="col-xs-12 col-sm-6 col-md-6 col-lg-6">
                                <label for=""><?php echo app('translator')->get('global.language'); ?></label>
                                <span><?php echo e(strtoupper(_e($contract->metadata,'language','-'))); ?></span>
                            </li>
                            <li class="col-xs-12 col-sm-6 col-md-6 col-lg-6">
                                <label for=""><?php echo app('translator')->get('global.country'); ?></label>
                                <?php if($code = strtolower(_e($contract->metadata->country,'code'))): ?>
                                    <span><a href="#"><?php echo e(ucfirst(_e($contract->metadata->country,'name'))); ?></a>
                                        <?php if(env("CATEGORY")=="rc"): ?>
                                            <?php if(isset($contract->metadata->url->amla) && !empty($contract->metadata->url->amla)): ?>
                                                <span class="amla-link">See <a href="<?php echo e($contract->metadata->url->amla); ?>"
                                                                               target="_blank">Legislation</a> in African Mining Legislation Atlas</span><?php endif; ?></span>
                                <?php endif; ?>
                                <?php endif; ?>

                            </li>
                        </ul>
                        <ul class="government-entity-wrap">
                            <li class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
                                <label for=""><?php echo app('translator')->get('global.government_entity'); ?></label>
                                <?php if(isset($contract->metadata->government_entity)): ?>
                                    <?php foreach($contract->metadata->government_entity as $governmentEntity): ?>
                                        <span>
                                        <?php if(isset($governmentEntity->name) && isset($governmentEntity->identifier) && !empty($governmentEntity->name)): ?>
                                                <?php echo e($governmentEntity->name); ?> <?php if($governmentEntity->identifier): ?>
                                                    (<?php echo e($governmentEntity->identifier); ?>)<?php endif; ?>
                                            <?php endif; ?>
                                    </span>
                                    <?php endforeach; ?>
                                <?php else: ?>
                                    -
                                <?php endif; ?>
                            </li>

                        </ul>
                        <ul>
                            <li class="col-xs-12 col-sm-6 col-md-6 col-lg-6">
                                <label for=""><?php echo app('translator')->get('global.signature_date'); ?></label>
                                <?php
                                $date = $contract->metadata->date_signed;
                                $date = strtotime($date);
                                ?>
                                <span><?php if($date): ?><?php echo e(date('F',$date)); ?> <?php echo e(date('d',$date)); ?>, <?php echo e(date('Y',$date)); ?><?php else: ?>
                                        - <?php endif; ?></span>
                            </li>
                            <li class="col-xs-12 col-sm-6 col-md-6 col-lg-6">
                                <label for=""><?php echo app('translator')->get('global.document_type'); ?></label>
                                <span><?php echo e(_e($contract->metadata,'type','-')); ?></span>
                            </li>
                        </ul>
                        <ul>
                            <li class="col-xs-12 col-sm-6 col-md-6 col-lg-6">
                                <label for=""><?php echo app('translator')->get('global.type_contract'); ?></label>
                                <span class="contract-type-list"><?php if(isset($contract->metadata->contract_type) && !empty($contract->metadata->contract_type) && is_array($contract->metadata->contract_type)): ?>
                                          <?php foreach($contract->metadata->contract_type as $contractype): ?>
                                            <a href="<?php echo e(route("search",['contract_type'=>$contractype])); ?>"><?php echo e($contractype); ?></a>
                                          <?php endforeach; ?>
                                        <?php endif; ?>
                                </span>
                            </li>
                            <li class="col-xs-12 col-sm-6 col-md-6 col-lg-6">
                                <label for=""><?php echo app('translator')->get('global.resource'); ?></label>
                                <?php
                                $resource = _e($contract->metadata, 'resource', '-');
                                $resource = is_array($resource) ? $resource : [];
                                ?>
                                <span class="resource-list">
                                <?php foreach($resource as $res): ?>
                                        <a href="<?php echo e(route("resource.detail",['key'=>urlencode($res)])); ?>"><?php echo e($res); ?></a>
                                    <?php endforeach; ?>
                            </span>
                            </li>
                        </ul>
                        <?php if(env('CATEGORY') =="olc"): ?>
                        <ul>
                            <li class="col-xs-12 col-sm-6 col-md-6 col-lg-6">
                                <label for=""><?php echo app('translator')->get('global.land_matrix_id'); ?></label>
                                <span><?php if(isset($contract->metadata->matrix_page) && isset($contract->metadata->deal_number) && !empty($contract->metadata->matrix_page) && !empty($contract->metadata->deal_number)): ?>
                                        <a  target="_blank" href="<?php echo e($contract->metadata->matrix_page); ?>">#<?php echo e($contract->metadata->deal_number); ?></a>
                                    <?php else: ?>
                                        - <?php endif; ?></span>
                            </li>
                        </ul>
                        <?php endif; ?>
                    </div>
                </div>
            </div>
            <div class="col-md-6 col-lg-6">
                <div class="panel panel-default panel-wrap panel-annotation-wrap">
                    <div class="panel-body">
                        <div class="annotation-block">
                            <div class="title"><?php echo app('translator')->get('global.annotations'); ?></div>
                            <ul>
                                <?php $i = 0; ?>
                                <?php $__empty_1 = true; foreach($contract->annotationsGroup as $category=>$annotation): $__empty_1 = false; ?>
                                
                                    <?php if($i < 5 ): ?>
                                        <li><a class="view-annotation-category"
                                               href="#<?php echo e(str_slug($category,'-')); ?>"><?php echo e($category); ?></a></li>
                                        <?php $i ++; ?>
                                    <?php endif; ?>
                                <?php endforeach; if ($__empty_1): ?>
                                    <div class="no-data"><?php echo app('translator')->get('contract.annotation_message'); ?></div>
                                <?php endif; ?>
                            </ul>
                        </div>
                        <div class="view-all-annotations">
                            <?php if(count($contract->annotationsGroup)>0): ?>
                                <a href="#annotations" class="view-annotation"><?php echo app('translator')->get('global.view_annotations'); ?></a>
                            <?php else: ?>
                                <a href="javascript:void();" class="view-annotation disabled"><?php echo app('translator')->get('global.view_annotations'); ?></a>
                            <?php endif; ?>

                        </div>
                    </div>
                </div>
            </div>
        </div>
        <?php if(isset($contract->metadata->note) && ($contract->metadata->note != "")): ?>
        <div class="col-lg-12">
            <div class="panel panel-default panel-wrap panel-contract-wrap">
                <div class="panel-body metadata-note">
                    <span>Note</span>
                   <?php echo e($contract->metadata->note); ?>

                </div>
            </div>
        </div>
        <?php endif; ?>
        <div class="col-lg-12">
            <div class="panel panel-default panel-wrap panel-contract-wrap">
                <div class="panel-heading">
                <?php echo app('translator')->get('contract.company'); ?>
            </div>
                <?php foreach($contract->metadata->participation as $company): ?>
                    <div class="panel-body panel-col3-wrap">
                        <ul>
                            <li class="col-xs-12 col-sm-4 col-md-4 col-lg-4">
                                <label for=""><?php echo app('translator')->get('contract.company_name'); ?></label>
                                <span><?php if(isset($company->name) && !empty($company->company->name)): ?> <a
                                            href="<?php echo e(route("search",['company_name'=>$company->company->name])); ?>"><?php echo e($company->company->name); ?> </a> <?php else: ?>
                                        - <?php endif; ?></span>
                            </li>
                            <li class="col-xs-12 col-sm-4 col-md-4 col-lg-4">
                                <label for=""><?php echo app('translator')->get('contract.jurisdiction'); ?></label>
                        <span>
                        <?php $ji = _e($company->company->identifier->creator, 'spatial', null);?>
                            <?php if(!is_null($ji)): ?>
                                <?php echo e(trans('country')[strtoupper($ji)]); ?>

                            <?php else: ?>
                                -
                            <?php endif; ?>
                        </span>
                            </li>
                            <li class="col-xs-12 col-sm-4 col-md-4 col-lg-4">
                                <label for=""><?php echo app('translator')->get('contract.open_corporate_ID'); ?></label>
                                <span><?php if(isset($company->company->opencorporates_link) && !empty($company->company->opencorporates_link)): ?><a
                                            href="<?php echo e($company->company->opencorporates_link); ?>"><?php echo e(str_limit($company->company->opencorporates_link,25)); ?></a> <?php else: ?>
                                        - <?php endif; ?></span>
                            </li>
                        </ul>
                        <ul>
                            <li class="col-xs-12 col-sm-4 col-md-4 col-lg-4">
                                <label for=""><?php echo app('translator')->get('contract.company_add'); ?></label>
                                <span><?php echo e(_e($company->company,'address','-')); ?></span>
                            </li>
                            <li class="col-xs-12 col-sm-4 col-md-4 col-lg-4">
                                <label for=""><?php echo app('translator')->get('contract.company_number'); ?></label>
                                <span><?php echo e(_e($company->company->identifier,'id','-')); ?></span>
                            </li>
                            <li class="col-xs-12 col-sm-4 col-md-4 col-lg-4">
                                <label for=""><?php echo app('translator')->get('contract.corporate_grouping'); ?></label>
                                <span><?php if(isset($company->company->corporate_grouping) && !empty($company->company->corporate_grouping)): ?>
                                        <a href="<?php echo e(route("search",['corporate_group'=>$company->company->corporate_grouping])); ?>"><?php echo e($company->company->corporate_grouping); ?> </a> <?php else: ?>
                                        - <?php endif; ?>
                                </span>
                            </li>
                        </ul>
                        <?php if(env('CATEGORY') != 'olc' ): ?>
                        <ul>
                            <li class="col-xs-12 col-sm-4 col-md-4 col-lg-4">
                                <label for=""><?php echo app('translator')->get('contract.registration_agency'); ?></label>
                                <span><?php echo e(_e($company->company->identifier->creator,'name','-')); ?></span>
                            </li>
                            <li class="col-xs-12 col-sm-4 col-md-4 col-lg-4">
                                <label for=""><?php echo app('translator')->get('contract.share'); ?></label>
                                <span>
                                    <?php
                                    $ps = _e($company,'share','');
                                    echo ($ps =='') ? '-' : $ps*100 .'%';
                                    ?>
                                    </span>
                            </li>
                            <li class="col-xs-12 col-sm-4 col-md-4 col-lg-4">
                                <label for=""><?php echo app('translator')->get('contract.operator'); ?></label>
                        <span><?php if(isset($company->is_operator)): ?>
                                <?php if($company->is_operator==1): ?>
                                    Yes
                                <?php elseif($company->is_operator==0): ?>
                                    No
                                <?php else: ?>
                                    -
                                <?php endif; ?>
                            <?php endif; ?>

                        </span>
                            </li>
                        </ul>
                            <?php endif; ?>
                    </div>
                <?php endforeach; ?>
            </div>
        </div>

        <div class="col-lg-12">
            <div class="panel panel-default panel-wrap panel-contract-wrap">
                <div class="panel-heading">
                <?php echo app('translator')->get('contract.associated_documents'); ?>
            </div>
                <div class="panel-body panel-table">
                    <table class="table table-responsive table-contract table-associated-contract">
                        <tbody>
                        <tr>
                            <?php foreach($contract->metadata->parent as $parentContract): ?>

                                <td width="70%">
                                    <?php if($parentContract->is_published==1): ?>
                                        <a href="<?php echo e(route('contract.detail',['id'=>$parentContract->open_contracting_id])); ?>"><?php echo e($parentContract->name); ?></a> &nbsp; (parent)
                                    <?php else: ?>
                                        <?php echo e($parentContract->name); ?> (parent)
                                    <?php endif; ?>
                                </td>
                            <?php endforeach; ?>
                        </tr>
                        <?php $supportingContracts = _e($contract->metadata, 'supporting', []);?>
                        <?php foreach($contract->metadata->supporting as $supportingContract): ?>
                            <tr>
                                <td width="70%">
                                    <?php if($supportingContract->is_published==1): ?>
                                        <a href="<?php echo e(route('contract.detail',['id'=>$supportingContract->open_contracting_id])); ?>"> <?php echo e($supportingContract->name); ?></a>
                                    <?php endif; ?>
                                </td>

                            </tr>
                        <?php endforeach; ?>

                        <?php if(empty($contract->metadata->parent) && empty($contract->metadata->supporting)): ?>
                            <tr>
                                <td class="no-data">
                                    <?php echo app('translator')->get('contract.ass_doc_msg'); ?>
                                </td>
                            </tr>
                        <?php endif; ?>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <?php if(env('CATEGORY') != 'olc'): ?>
        <div class="col-lg-12">
            <div class="panel panel-default panel-wrap panel-contract-wrap">
                <div class="panel-heading">
                <?php echo app('translator')->get('contract.concession'); ?>
            </div>
                <div class="panel-body">
                    <ul>
                        <li class="col-xs-12 col-sm-6 col-md-6 col-lg-6">
                            <label for=""><?php echo app('translator')->get('contract.project_title'); ?></label>
                            <span><?php echo e(_e($contract->metadata->project,'name','-')); ?></span>
                        </li>
                        <li class="col-xs-12 col-sm-6 col-md-6 col-lg-6">
                            <label for=""><?php echo app('translator')->get('contract.project_identifier'); ?></label>
                            <span><?php echo e(_e($contract->metadata->project,'identifier','-')); ?></span>
                        </li>
                    </ul>
                    <ul>
                        <?php
                        $concessions = _e($contract->metadata, 'concession', []);
                        ?>
                        <?php foreach($concessions as $concession): ?>
                            <li class="col-xs-12 col-sm-6 col-md-6 col-lg-6">
                                <label for=""><?php echo app('translator')->get('contract.license_name'); ?></label>
                                <span><?php echo e(_e($concession,'name','-')); ?></span>
                            </li>
                            <li class="col-xs-12 col-sm-6 col-md-6 col-lg-6">
                                <label for=""><?php echo app('translator')->get('contract.license_identifier'); ?></label>
                                <span><?php echo e(_e($concession,'identifier','-')); ?></span>
                            </li>
                        <?php endforeach; ?>
                    </ul>
                </div>
            </div>
        </div>
        <?php endif; ?>
        <div class="col-lg-12">
            <div class="panel panel-default panel-wrap panel-contract-wrap">
                <div class="panel-heading">
                <?php echo app('translator')->get('contract.source'); ?>
            </div>
                <div class="panel-body">
                    <ul>
                        <li class="col-xs-12 col-sm-6 col-md-6 col-lg-6">
                            <label for=""><?php echo app('translator')->get('contract.source_url'); ?></label>
                            <span><?php if(!empty(_e($contract->metadata->url,'source'))): ?><a
                                        href="<?php echo e($contract->metadata->url->source); ?>"
                                        target="_blank"><?php echo e(str_limit($contract->metadata->url->source,50)); ?></a><?php else: ?>
                                    -<?php endif; ?></span>
                        </li>
                        <li class="col-xs-12 col-sm-6 col-md-6 col-lg-6">
                            <label for=""><?php echo app('translator')->get('contract.disclosure_mode'); ?></label>
                            <span><?php echo e(_e($contract->metadata,'publisher_type','-')); ?></span>
                        </li>
                    </ul>
                </div>
            </div>
        </div>
    </div>
    <?php if(count($contract->annotationsGroup)>0): ?>
        <div class="row annotation-list-wrapper" id="annotations">
            <div class="col-lg-12">
                <div class="panel panel-default panel-wrap panel-annotation-list-wrap">
                    <div class="panel-heading">Annotations</div>
                    <div class="panel-body">
                        <div class="annotation-category-cluster">
                            <ul>
                                <li><a class="view-annotation-cluster active" href="#cluster-all">All</a></li>
                                <?php foreach($contract->annotationsCluster as $cluster=>$value): ?>
                                    <li><a class="view-annotation-cluster" href="#cluster-<?php echo e(str_slug($cluster,40)); ?>"><?php echo e($cluster); ?></a></li>
                                <?php endforeach; ?>
                            </ul>

                        </div>

                        <?php $__empty_1 = true; foreach($contract->annotationsCluster as $cluster  => $categories): $__empty_1 = false; ?>
                            <div id="cluster-<?php echo e(str_slug($cluster,'-')); ?>" class="cluster-wrap">
                                <div class="category-title">
                                    <?php echo e($cluster); ?>

                                </div>

                                    <?php foreach($categories as $category => $annotations): ?>
                                    <div id="<?php echo e(str_slug($category,'-')); ?>" class="sub-category">
                                        <a href="#<?php echo e(str_slug($category,'-')); ?>"><i class='glyphicon glyphicon-link' style="display:none;"></i></a>
                                        <?php echo e($category); ?>

                                    </div>
                                    <ul class="row">
                                    <?php foreach($annotations as $text => $annots): ?>
                                        <?php
                                            $a = explode('--',$text);
                                            $preamble =  isset($a[1]) ? $a[1] : '';
                                            $text=  isset($a[0]) ? $a[0] : '';
                                            ?>
                                            <li class="col-xs-12 col-sm-6 col-md-6 col-lg-6">
                                                <div class="pull-left">
                                                    <div class="annotation-text">
                                                        <?php echo e($text); ?>

                                                    </div>

                                                    <p class="annotation-preamle">
                                                    <?php if($preamble !=''): ?>
                                                        <?php echo e($preamble); ?>

                                                    <?php endif; ?>
                                                        <p>
                                                        <?php foreach($annots as $key => $annotation): ?>
                                                            <?php $annotation_type = isset($annotation->shapes) ? 'pdf' : 'text'; ?>
                                                            <a  href="<?php echo e(route('contract.detail',['id'=>$contract->metadata->open_contracting_id])); ?>#/<?php echo e($annotation_type); ?>/page/<?php echo e($annotation->page_no); ?>/annotation/<?php echo e($annotation->id); ?>">
                                                                Page <?php echo e(_e($annotation,'page_no')); ?></a><?php if($key >= 0 && $key < (count($annots)-1)): ?>, <?php endif; ?>
                                                        <?php endforeach; ?>
                                                        </p>
                                                    </p>
                                                </div>
                                            </li>
                                        <?php endforeach; ?>
                                    </ul>
                                <?php endforeach; ?>
                            </div>
                        <?php endforeach; if ($__empty_1): ?>

                            <div class="category-wrap">
                                <ul>
                                    <li class="no-data"><?php echo app('translator')->get('contract.annotation_message'); ?></li>
                                </ul>
                            </div>
                        <?php endif; ?>
                    </div>
                </div>
            </div>
        </div>
        <script>
        var lang = <?php echo json_encode(trans('annotation'));?>;
        </script>
    <?php endif; ?>
<?php $__env->stopSection(); ?>

<?php echo $__env->make('layout.app-full', array_except(get_defined_vars(), array('__data', '__path')))->render(); ?>